function setup_breed_button(e,t,n,r,a,i,u,l,o,d,p,c){var s=document.createElement("input");s.type="button",s.value="Make babies!",s.onclick=function(){breed_pups(e,t,n,r,a,i,u,l,o,d,c)},p.appendChild(s)}function breed_pups(e,t,n,r,a,i,u,l,o,d,p){var c=get_genomes_from_input(e,t),s=get_traits_from_input(r),m=i.value,v=parse_stats(e,l.value),_=get_genomes_from_input(e,n),f=get_traits_from_input(a),h=u.value,g=parse_stats(e,o.value),b=get_active_specials(e,r,a,d),E=specials_to_effects(e,b),C=breed_pupcount(E),M=document.createElement("div"),T=document.createElement("h3");T.innerHTML="Litter",M.appendChild(T);var L=document.createElement("input");L.type="button",L.value="X",L.onclick=function(){p.removeChild(M)},M.appendChild(L);for(var y=0;C>y;y++){var H=document.createElement("div");H.className="offspring";var T=document.createElement("h3");T.innerHTML="Child",H.appendChild(T);var x=breed_ismale(E),N=document.createElement("p");x?N.innerHTML="Male":N.innerHTML="Female",H.appendChild(N);var O=breed_genomes(e,c,_),k=document.createElement("p");if(k.innerHTML=genomes_to_str(e,O),H.appendChild(k),get_effect_value(E,"extraGenomeRoll",!1)){var S=breed_genomes(e,c,_),B=document.createElement("p");B.innerHTML="extra roll:<br>"+genomes_to_str(e,S),H.appendChild(B)}var A=document.createElement("p");A.innerHTML="Traits: "+breed_traits(e,s,f,x),H.appendChild(A);var R=breed_build(e,m,h,E),j=document.createElement("p");j.innerHTML="Build: "+R,H.appendChild(j);var q=document.createElement("p");q.innerHTML="Stats: "+stats_to_str(calculate_pup_stats(e,v,g,R)),H.appendChild(q),M.appendChild(H)}p.insertBefore(M,p.childNodes[0])}function setup_stats_button(e,t,n,r,a,i,u,l,o,d,p,c){var s=document.createElement("input");s.type="button",s.value="Statistical average",s.onclick=function(){breed_statistics_test(e,t,n,r,a,i,u,l,o,d,c)},p.appendChild(s)}function breed_statistics_test(e,t,n,r,a,i,u,l,o,d,p){var c=(get_genomes_from_input(e,t),get_traits_from_input(r)),s=i.value,m=(parse_stats(e,l.value),get_genomes_from_input(e,n),get_traits_from_input(a)),v=u.value,_=(parse_stats(e,o.value),get_active_specials(e,r,a,d)),f=specials_to_effects(e,_),h=document.createElement("div"),g=document.createElement("h3");g.innerHTML="Statistics test",h.appendChild(g);var b=document.createElement("input");b.type="button",b.value="X",b.onclick=function(){p.removeChild(h)},h.appendChild(b);var E=document.createElement("input");E.type="button",E.value="Repeat",E.onclick=function(){A()},h.appendChild(E);var C=document.createElement("p");h.appendChild(C);var M=document.createElement("p");h.appendChild(M);var T=document.createElement("p");h.appendChild(T);var L=document.createElement("p");h.appendChild(L);var y=document.createElement("p");h.appendChild(y);var H=document.createElement("p");h.appendChild(H),p.insertBefore(h,p.childNodes[0]);var x=0,N={},O={},k={},S={},B=0,A=function(){for(var t=0;1e4>t;t++){x+=1;var n=breed_pupcount(f),r=breed_build(e,s,v,f),a=breed_traits(e,c,m,!0),i=breed_traits(e,c,m,!1);n in N?N[n]+=1:N[n]=1,r in O?O[r]+=1:O[r]=1,breed_ismale(f)&&(B+=1);for(var u=0;u<a.length;u++){var l=a[u];l in k?k[l]+=1:k[l]=1}for(var u=0;u<i.length;u++){var l=i[u];l in S?S[l]+=1:S[l]=1}}C.innerHTML=x.toString()+" repeats",M.innerHTML="PUPS:<br>";for(var t in N)M.innerHTML+=t.toString()+": "+N[t]/x+"<br>";T.innerHTML="MALE RATIO:<br>"+B/x,H.innerHTML="BUILDS:<br>";for(var t in O)H.innerHTML+=t.toString()+": "+O[t]/x+"<br>";L.innerHTML="MALE TRAITS:<br>";for(var t in k)L.innerHTML+=t+": "+k[t]/x+"<br>";y.innerHTML="FEMALE TRAITS:<br>";for(var t in S)y.innerHTML+=t+": "+S[t]/x+"<br>"};A()}function parse_stats(e,t){var n=e.build.stats,r=/([0-9]+[.]?[0-9]*)/g,a=t.match(r);if(null===a)return null;var i=a.map(parseFloat);if(i.length!=n.length)return null;for(var u={},l=0;l<n.length;l++)u[n[l]]=i[l];return u}function setup_build_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Build";var a=document.createElement("select");n.appendChild(r),n.appendChild(a);for(var i in e.build.modifiers){var u=document.createElement("option"),l=document.createTextNode(i);u.value=i,u.appendChild(l),a.appendChild(u)}return t.appendChild(n),a}function setup_stats_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Stats",n.appendChild(r);var a=document.createElement("input");return n.appendChild(a),t.appendChild(n),a.oninput=function(){""===this.value?this.className="":null===parse_stats(e,this.value)?this.className="invalid_input":this.className="valid_input"},a}function stats_to_str(e){strs=[];for(var t in e)strs.push(t+": "+e[t].toFixed());return strs.join(", ")}function calculate_pup_stats(e,t,n,r){for(var a={},i=0;i<e.build.stats.length;i++){var u=e.build.stats[i];a[u]=(t[u]+n[u])/e.build.modifiers[r]}return a}function get_pup_build_choices(e,t,n){return t+n in e.build.inheritance?e.build.inheritance[t+n]:n+t in e.build.inheritance?e.build.inheritance[n+t]:null}function breed_build(e,t,n,r){var a=get_effect_value(r,"bestAvailableBuild",!1),i=get_pup_build_choices(e,t,n);return a?i.slice(0).sort(function(t,n){return e.build.modifiers[t]-e.build.modifiers[n]})[0]:i[Math.floor(Math.random()*i.length)]}function setup_genome_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Genome",n.appendChild(r);for(var a in e.genotypes){var i=document.createElement("input");i.type="text",i.re_genes=get_genome_template(e,a);var r=document.createElement("h4");r.innerHTML=a;var u=document.createElement("div");i.output=u,n.appendChild(r),n.appendChild(i),n.appendChild(u),i.oninput=function(){""==this.value?this.className="":null===str_to_genome(this.value,this.re_genes)?this.className="invalid_input":this.className="valid_input"}}return t.appendChild(n),n}function get_genome_template(e,t){var n=e.genotypes[t],r=[];for(var a in n){var i=a,u=n[a].genotypes,l=n[a].required,o=u.join("|"),d=new RegExp("^("+o+")("+o+")$"),p=[i,d,l];r.push(p)}return r}function str_to_gene(e,t,n){var r=t,a=e[r][0],i=e[r][1],u=n.match(i);return null===u?null:(gene_left=u[1],gene_right=u[2],[a,gene_left,gene_right])}function verify_required(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=r[2],i=r[0];if(a&&!(i in t))return!1}return!0}function str_to_genome(e,t){for(var n={},r=/[ ]+/,a=0,i=e.split(r),u=0;u<i.length;u++){var l=i[u];if(""!==l&&l!==empty_pair){for(var o=null,d=a;d<t.length;d++){var p=str_to_gene(t,d,l);if(null!==p){o=p,a=d+1;break}}if(null===o)return null;n[o[0]]=[o[1],o[2]]}}return verify_required(t,n)?n:null}function get_genomes_from_input(e,t){for(var n={},r=t.getElementsByTagName("input"),a=0;a<r.length;a++){var i=Object.keys(e.genotypes)[a],u=r[a].re_genes;n[i]=str_to_genome(r[a].value,u)}return n}function genomes_to_str(e,t){str="";for(var n in t)str+=n+": "+genome_to_str(e,n,t[n])+"<br>";return str}function genome_to_str(e,t,n){function r(n){var r=function(r,a){return e.genotypes[t][n].genotypes.indexOf(r)-e.genotypes[t][n].genotypes.indexOf(a)};return r}var a=[];for(var i in n)if("n"!=n[i][0]||"n"!=n[i][1]){var u=n[i].slice(0).sort(r(i));a.push(u.join(""))}return a.join(" ")}function breed_genomes(e,t,n){var r=e.genotypes,a={};for(var i in r){var u={};for(var l in r[i]){var o,d;o=t[i][l],d=n[i][l],void 0===o&&(o=["n","n"]),void 0===d&&(d=["n","n"]);var p=o[Math.floor(2*Math.random())],c=d[Math.floor(2*Math.random())];u[l]=[p,c]}a[i]=u}return a}function setup_special_options(e,t){var n=e.special,r=document.createElement("div");r.className="input_container";var a=document.createElement("ul");r.appendChild(a);for(var i in n)if("option"==n[i].activation[0]){var u=document.createElement("li");a.appendChild(u);var l=document.createElement("input");l.type="checkbox",l.value=i,u.appendChild(l);var o=document.createTextNode(i);u.appendChild(o)}return t.appendChild(r),r}function get_active_specials(e,t,n,r){for(var a=get_traits_from_input(n),i=get_traits_from_input(t),u=[],l=r.getElementsByTagName("input"),o=0;o<l.length;o++){var d=l[o];d.checked&&u.push(d.value)}var p=e.special,c=[];for(var s in p){var m=p[s],v=m.activation[0];if("option"==v)u.indexOf(s)>-1&&c.push(s);else if("trait"==v){var _=m.activation[1];a.indexOf(_)>-1?c.push(s):i.indexOf(_)>-1&&c.push(s)}}for(var f=c.slice(),o=0;o<c.length;o++){var m=c[o];if(-1!=f.indexOf(m))for(var h=p[m].disabledwith,g=0;g<h.length;g++)if(c.indexOf(h[g])>-1){f.splice(f.indexOf(m),1);break}}return f}function specials_to_effects(e,t){var n={},r=function(e,t){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])<0)return!1;return!0},a=e.effects;for(var i in a){var u=a[i].type,l=a[i].requires,o=a[i].value;r(t,l)&&(n[u]=o)}return console.log(n),n}function get_effect_value(e,t,n){var r=n;return t in e&&(r=e[t]),r}function breed_ismale(e){var t=get_effect_value(e,"maleChance",.5);return Math.random()<t?!0:!1}function breed_pupcount(e){var t,n=get_effect_value(e,"offspringChance",[0,1]),r=Math.random(),a=0;for(t=0;t<n.length&&(a+=n[t],!(a>r));t++);return t}function setup_trait_input(e,t,n){var r=document.createElement("div");r.className="input_container";var a=document.createElement("h3");a.innerHTML="Traits",r.appendChild(a);var i=document.createElement("ul");r.appendChild(i);var u=e.traits;for(var l in u){var o=u[l];if((!n||o.male)&&(n||o.female)&&0!==o.inherit){var d=document.createElement("li"),p=document.createElement("input"),a=document.createTextNode(l);p.type="checkbox",p.value=l,d.appendChild(p),d.appendChild(a),i.appendChild(d)}}return t.appendChild(r),i}function calculate_pup_traits(e,t,n,r){var a=e.traits,i={};for(var u in a){var l=a[u];!r&&!l.female||r&&!l.male?i[u]=0:t.indexOf(u)>-1&&n.indexOf(u)>-1?i[u]=1-(1-l.mutate)*(1-l.inherit)*(1-l.inherit):t.indexOf(u)>-1||n.indexOf(u)>-1?i[u]=1-(1-l.mutate)*(1-l.inherit):i[u]=l.mutate}return i}function breed_traits(e,t,n,r){var a=calculate_pup_traits(e,t,n,r),i=[];for(var u in a){var l=a[u];Math.random()<l&&i.push(u)}return i}function get_traits_from_input(e){for(var t=[],n=e.getElementsByTagName("input"),r=0;r<n.length;r++)n[r].checked&&t.push(n[r].value);return t}var empty_pair="nn";