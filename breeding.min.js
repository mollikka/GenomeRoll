function setup_breed_button(e,t,n,r,a,i,u,l,o,d,p,c){var s=document.createElement("input");s.type="button",s.value="Make babies!",s.onclick=function(){breed_pups(e,t,n,r,a,i,u,l,o,d,c)},p.appendChild(s)}function breed_pups(e,t,n,r,a,i,u,l,o,d,p){var c=get_genomes_from_input(e,t),s=get_traits_from_input(r),m=i.value,v=parse_stats(e,l.value),_=get_genomes_from_input(e,n),f=get_traits_from_input(a),h=u.value,g=parse_stats(e,o.value),b=get_active_specials(e,r,a,d),C=specials_to_effects(e,b),E=breed_pupcount(C),M=document.createElement("div"),x=document.createElement("h3");x.innerHTML="Litter",M.appendChild(x);var y=document.createElement("input");y.type="button",y.value="X",y.onclick=function(){p.removeChild(M)},M.appendChild(y);for(var T=0;E>T;T++){var N=document.createElement("div");N.className="offspring";var x=document.createElement("h3");x.innerHTML="Child",N.appendChild(x);var L=breed_ismale(C),O=document.createElement("p");L?O.innerHTML="Male":O.innerHTML="Female",N.appendChild(O);var H=breed_genomes(e,c,_),k=document.createElement("p");if(k.innerHTML=genomes_to_str(e,H),N.appendChild(k),get_effect_value(C,"extraGenomeRoll",!1)){var B=breed_genomes(e,c,_),j=document.createElement("p");j.innerHTML="extra roll:<br>"+genomes_to_str(e,B),N.appendChild(j)}var q=document.createElement("p");q.innerHTML="Traits: "+breed_traits(e,s,f,L),N.appendChild(q);var F=breed_build(e,m,h),w=document.createElement("p");w.innerHTML="Build: "+F,N.appendChild(w);var G=document.createElement("p");G.innerHTML="Stats: "+stats_to_str(calculate_pup_stats(e,v,g,F,C)),N.appendChild(G),M.appendChild(N)}p.insertBefore(M,p.childNodes[0])}function parse_stats(e,t){var n=e.build.stats,r=/([0-9]+[.]?[0-9]*)/g,a=t.match(r);if(null===a)return null;var i=a.map(parseFloat);if(i.length!=n.length)return null;for(var u={},l=0;l<n.length;l++)u[n[l]]=i[l];return u}function setup_build_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Build";var a=document.createElement("select");n.appendChild(r),n.appendChild(a);for(var i in e.build.modifiers){var u=document.createElement("option"),l=document.createTextNode(i);u.value=i,u.appendChild(l),a.appendChild(u)}return t.appendChild(n),a}function setup_stats_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Stats",n.appendChild(r);var a=document.createElement("input");return n.appendChild(a),t.appendChild(n),a.oninput=function(){""===this.value?this.className="":null===parse_stats(e,this.value)?this.className="invalid_input":this.className="valid_input"},a}function stats_to_str(e){strs=[];for(var t in e)strs.push(t+": "+e[t].toFixed(2));return strs.join(", ")}function calculate_pup_stats(e,t,n,r,a){for(var i=get_effect_value(a,"buildOverride",r),u={},l=0;l<e.build.stats.length;l++){var o=e.build.stats[l];u[o]=(t[o]+n[o])/e.build.modifiers[i]}return u}function get_pup_build_choices(e,t,n){return t+n in e.build.inheritance?e.build.inheritance[t+n]:n+t in e.build.inheritance?e.build.inheritance[n+t]:null}function breed_build(e,t,n){var r=get_pup_build_choices(e,t,n);return r[Math.floor(Math.random()*r.length)]}function setup_genome_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Genome",n.appendChild(r);for(var a in e.genotypes){var i=document.createElement("input");i.type="text",i.re_genes=get_genome_template(e,a);var r=document.createElement("h4");r.innerHTML=a;var u=document.createElement("div");i.output=u,n.appendChild(r),n.appendChild(i),n.appendChild(u),i.oninput=function(){""==this.value?this.className="":null===str_to_genome(this.value,this.re_genes)?this.className="invalid_input":this.className="valid_input"}}return t.appendChild(n),n}function get_genome_template(e,t){var n=e.genotypes[t],r=[];for(var a in n){var i=a,u=n[a].genotypes,l=n[a].required,o=u.join("|"),d=new RegExp("^("+o+")("+o+")$"),p=[i,d,l];r.push(p)}return r}function str_to_gene(e,t,n){var r=t,a=e[r][0],i=e[r][1],u=n.match(i);return null===u?null:(gene_left=u[1],gene_right=u[2],[a,gene_left,gene_right])}function verify_required(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=r[2],i=r[0];if(a&&!(i in t))return!1}return!0}function str_to_genome(e,t){for(var n={},r=/[ ]+/,a=0,i=e.split(r),u=0;u<i.length;u++){var l=i[u];if(""!==l&&l!==empty_pair){for(var o=null,d=a;d<t.length;d++){var p=str_to_gene(t,d,l);if(null!==p){o=p,a=d+1;break}}if(null===o)return null;n[o[0]]=[o[1],o[2]]}}return verify_required(t,n)?n:null}function get_genomes_from_input(e,t){for(var n={},r=t.getElementsByTagName("input"),a=0;a<r.length;a++){var i=Object.keys(e.genotypes)[a],u=r[a].re_genes;n[i]=str_to_genome(r[a].value,u)}return n}function genomes_to_str(e,t){str="";for(var n in t)str+=n+": "+genome_to_str(e,n,t[n])+"<br>";return str}function genome_to_str(e,t,n){function r(n){var r=function(r,a){return e.genotypes[t][n].genotypes.indexOf(r)-e.genotypes[t][n].genotypes.indexOf(a)};return r}var a=[];for(var i in n)if("n"!=n[i][0]||"n"!=n[i][1]){var u=n[i].slice(0).sort(r(i));a.push(u.join(""))}return a.join(" ")}function breed_genomes(e,t,n){var r=e.genotypes,a={};for(var i in r){var u={};for(var l in r[i]){var o,d;o=t[i][l],d=n[i][l],void 0===o&&(o=["n","n"]),void 0===d&&(d=["n","n"]);var p=o[Math.floor(2*Math.random())],c=d[Math.floor(2*Math.random())];u[l]=[p,c]}a[i]=u}return a}function setup_special_options(e,t){var n=e.special,r=document.createElement("div");r.className="input_container";var a=document.createElement("ul");r.appendChild(a);for(var i in n)if("option"==n[i].activation[0]){var u=document.createElement("li");a.appendChild(u);var l=document.createElement("input");l.type="checkbox",l.value=i,u.appendChild(l);var o=document.createTextNode(i);u.appendChild(o)}return t.appendChild(r),r}function get_active_specials(e,t,n,r){for(var a=get_traits_from_input(n),i=get_traits_from_input(t),u=[],l=r.getElementsByTagName("input"),o=0;o<l.length;o++){var d=l[o];d.checked&&u.push(d.value)}var p=e.special,c=[];for(var s in p){var m=p[s],v=m.activation[0];if("option"==v)u.indexOf(s)>-1&&c.push(s);else if("trait"==v){var _=m.activation[1];a.indexOf(_)>-1?c.push(s):i.indexOf(_)>-1&&c.push(s)}}for(var f=c.slice(),o=0;o<c.length;o++){var m=c[o];if(-1!=f.indexOf(m))for(var h=p[m].disabledwith,g=0;g<h.length;g++)if(c.indexOf(h[g])>-1){f.splice(f.indexOf(m),1);break}}return f}function specials_to_effects(e,t){var n={},r=function(e,t){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])<0)return!1;return!0},a=e.effects;for(var i in a){var u=a[i].type,l=a[i].requires,o=a[i].value;r(t,l)&&(n[u]=o)}return console.log(n),n}function get_effect_value(e,t,n){var r=n;return t in e&&(r=e[t]),r}function breed_ismale(e){var t=get_effect_value(e,"maleChance",.5);return Math.random()<t?!0:!1}function breed_pupcount(e){var t,n=get_effect_value(e,"offspringChance",[0,1]),r=Math.random(),a=0;for(t=0;t<n.length&&(a+=n[t],!(a>r));t++);return t}function setup_trait_input(e,t,n){var r=document.createElement("div");r.className="input_container";var a=document.createElement("h3");a.innerHTML="Traits",r.appendChild(a);var i=document.createElement("ul");r.appendChild(i);var u=e.traits;for(var l in u){var o=u[l];if((!n||o.male)&&(n||o.female)&&0!==o.inherit){var d=document.createElement("li"),p=document.createElement("input"),a=document.createTextNode(l);p.type="checkbox",p.value=l,d.appendChild(p),d.appendChild(a),i.appendChild(d)}}return t.appendChild(r),i}function calculate_pup_traits(e,t,n,r){var a=e.traits,i={};for(var u in a){var l=a[u];!r&&!l.female||r&&!l.male?i[u]=0:t.indexOf(u)>-1&&n.indexOf(u)>-1?i[u]=1-(1-l.mutate)*(1-l.inherit)*(1-l.inherit):t.indexOf(u)>-1||n.indexOf(u)>-1?i[u]=1-(1-l.mutate)*(1-l.inherit):i[u]=l.mutate}return i}function breed_traits(e,t,n,r){var a=calculate_pup_traits(e,t,n,r),i=[];for(var u in a){var l=a[u];Math.random()<l&&i.push(u)}return i}function get_traits_from_input(e){for(var t=[],n=e.getElementsByTagName("input"),r=0;r<n.length;r++)n[r].checked&&t.push(n[r].value);return t}var empty_pair="nn";