function setup_breed_button(e,t,n,r,a,i,l,u,o,p,d){var c=document.createElement("input");c.type="button",c.value="Make a baby!",c.onclick=function(){breed_one_pup(e,t,n,r,a,i,l,u,o,d)},p.appendChild(c)}function breed_one_pup(e,t,n,r,a,i,l,u,o,p){var d=get_genomes_from_input(e,t),c=get_traits_from_input(r),s=i.value,m=parse_stats(e,u.value),v=get_genomes_from_input(e,n),_=get_traits_from_input(a),h=l.value,f=parse_stats(e,o.value),g=document.createElement("div");g.className="offspring";var E=document.createElement("h3");E.innerHTML="Child",g.appendChild(E);var b=breed_ismale(),C=document.createElement("p");b?C.innerHTML="Male":C.innerHTML="Female",g.appendChild(C);var M=breed_genomes(e,d,v),N=document.createElement("p");N.innerHTML=genomes_to_str(e,M),g.appendChild(N);var y=document.createElement("p");y.innerHTML="Traits: "+breed_traits(e,c,_,b),g.appendChild(y);var T=breed_build(e,s,h),x=document.createElement("p");x.innerHTML="Build: "+T,g.appendChild(x);var O=document.createElement("p");O.innerHTML="Stats: "+stats_to_str(calculate_pup_stats(e,m,f,T)),g.appendChild(O);var L=document.createElement("input");L.type="button",L.value="X",L.onclick=function(){p.removeChild(g)},g.appendChild(L),p.appendChild(g)}function parse_stats(e,t){var n=e.build.stats,r=/([0-9]+[.]?[0-9]*)/g,a=t.match(r);if(null===a)return null;var i=a.map(parseFloat);if(i.length!=n.length)return null;for(var l={},u=0;u<n.length;u++)l[n[u]]=i[u];return l}function setup_build_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Build";var a=document.createElement("select");n.appendChild(r),n.appendChild(a);for(var i in e.build.modifiers){var l=document.createElement("option"),u=document.createTextNode(i);l.value=i,l.appendChild(u),a.appendChild(l)}return t.appendChild(n),a}function setup_stats_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Stats",n.appendChild(r);var a=document.createElement("input");return n.appendChild(a),t.appendChild(n),a.oninput=function(){""===this.value?this.className="":null===parse_stats(e,this.value)?this.className="invalid_input":this.className="valid_input"},a}function stats_to_str(e){strs=[];for(var t in e)strs.push(t+": "+e[t].toFixed(2));return strs.join(", ")}function calculate_pup_stats(e,t,n,r){for(var a={},i=0;i<e.build.stats.length;i++){var l=e.build.stats[i];a[l]=(t[l]+n[l])/e.build.modifiers[r]}return a}function get_pup_build_choices(e,t,n){return t+n in e.build.inheritance?e.build.inheritance[t+n]:n+t in e.build.inheritance?e.build.inheritance[n+t]:null}function breed_build(e,t,n){var r=get_pup_build_choices(e,t,n);return r[Math.floor(Math.random()*r.length)]}function setup_genome_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Genome",n.appendChild(r);for(var a in e.genotypes){var i=document.createElement("input");i.type="text",i.re_genes=get_genome_template(e,a);var r=document.createElement("h4");r.innerHTML=a;var l=document.createElement("div");i.output=l,n.appendChild(r),n.appendChild(i),n.appendChild(l),i.oninput=function(){""==this.value?this.className="":null===str_to_genome(this.value,this.re_genes)?this.className="invalid_input":this.className="valid_input"}}return t.appendChild(n),n}function get_genome_template(e,t){var n=e.genotypes[t],r=[];for(var a in n){var i=a,l=n[a].genotypes,u=n[a].required,o=l.join("|"),p=new RegExp("^("+o+")("+o+")$"),d=[i,p,u];r.push(d)}return r}function str_to_gene(e,t,n){var r=t,a=e[r][0],i=e[r][1],l=n.match(i);return console.log("Testing if",n,"is",a," - ",!(null===l)),null===l?null:(gene_left=l[1],gene_right=l[2],[a,gene_left,gene_right])}function verify_required(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=r[2],i=r[0];if(a&&!(i in t))return!1}return!0}function str_to_genome(e,t){console.log("PARSING GENOME",e);for(var n={},r=/[ ]+/,a=0,i=e.split(r),l=0;l<i.length;l++){var u=i[l];if(""!==u&&u!==empty_pair){for(var o=null,p=a;p<t.length;p++){var d=str_to_gene(t,p,u);if(null!==d){o=d,a=p+1;break}}if(null===o)return console.log("FAILED TO PARSE GENOME"),null;n[o[0]]=[o[1],o[2]]}}return verify_required(t,n)?(console.log("GENOME PARSED SUCCESSFULLY"),n):(console.log("REQUIRED GENE MISSING"),null)}function get_genomes_from_input(e,t){for(var n={},r=t.getElementsByTagName("input"),a=0;a<r.length;a++){var i=Object.keys(e.genotypes)[a],l=r[a].re_genes;n[i]=str_to_genome(r[a].value,l)}return n}function genomes_to_str(e,t){str="";for(var n in t)str+=n+": "+genome_to_str(e,n,t[n])+"<br>";return str}function genome_to_str(e,t,n){function r(n){var r=function(r,a){return e.genotypes[t][n].genotypes.indexOf(r)-e.genotypes[t][n].genotypes.indexOf(a)};return r}var a=[];for(var i in n)if("n"!=n[i][0]||"n"!=n[i][1]){var l=n[i].slice(0).sort(r(i));a.push(l.join(""))}return a.join(" ")}function breed_genomes(e,t,n){var r=e.genotypes,a={};for(var i in r){var l={};for(var u in r[i]){var o,p;o=t[i][u],p=n[i][u],void 0===o&&(o=["n","n"]),void 0===p&&(p=["n","n"]),console.log(o,p);var d=o[Math.floor(2*Math.random())],c=p[Math.floor(2*Math.random())];l[u]=[d,c]}a[i]=l}return a}function setup_special_options(e,t){var n=e.special,r=document.createElement("div");r.className="input_container";var a=document.createElement("ul");r.appendChild(a);for(var i in n)if("option"==n[i].activation[0]){var l=document.createElement("li");a.appendChild(l);var u=document.createElement("input");u.type="checkbox",u.value=i,l.appendChild(u);var o=document.createTextNode(i);l.appendChild(o)}t.appendChild(r)}function get_active_effects(e,t,n,r){for(var a=[],i=[],l=[],u=n.getElementsByTagName("input"),o=0;o<u.length;o++){var p=u[o];p.checked&&a.push(p.value)}for(var d=t.getElementsByTagName("input"),o=0;o<d.length;o++){var p=d[o];p.checked&&i.push(p.value)}for(var c=r.getElementsByTagName("input"),o=0;o<c.length;o++){var p=c[o];p.checked&&l.push(p.value)}var s=e.special,m=[];for(var v in s){var _=s[v],h=_.activation[0];if("option"==h)l.indexOf(v)>-1&&m.push(v);else if("trait"==h){var f=_.activation[1];a.indexOf(f)>-1?m.push(v):i.indexOf(f)>-1&&m.push(v)}}for(var g=m.slice(),o=0;o<m.length;o++){var _=m[o];if(-1!=g.indexOf(_))for(var E=s[_].disabledwith,b=0;b<E.length;b++)if(m.indexOf(E[b])>-1){g.splice(g.indexOf(_),1);break}}return g}function breed_ismale(){return Math.random()<.5?!0:!1}function setup_trait_input(e,t,n){var r=document.createElement("div");r.className="input_container";var a=document.createElement("h3");a.innerHTML="Traits",r.appendChild(a);var i=document.createElement("ul");r.appendChild(i);var l=e.traits;for(var u in l){var o=l[u];if((!n||o.male)&&(n||o.female)&&0!==o.inherit){var p=document.createElement("li"),d=document.createElement("input"),a=document.createTextNode(u);d.type="checkbox",d.value=u,p.appendChild(d),p.appendChild(a),i.appendChild(p)}}return t.appendChild(r),i}function calculate_pup_traits(e,t,n,r){var a=e.traits,i={};for(var l in a){var u=a[l];!r&&!u.female||r&&!u.male?i[l]=0:t.indexOf(l)>-1&&n.indexOf(l)>-1?i[l]=1-(1-u.mutate)*(1-u.inherit)*(1-u.inherit):t.indexOf(l)>-1||n.indexOf(l)>-1?i[l]=1-(1-u.mutate)*(1-u.inherit):i[l]=u.mutate}return i}function breed_traits(e,t,n,r){var a=calculate_pup_traits(e,t,n,r),i=[];for(var l in a){var u=a[l];Math.random()<u&&i.push(l)}return i}function get_traits_from_input(e){for(var t=[],n=e.getElementsByTagName("input"),r=0;r<n.length;r++)n[r].checked&&t.push(n[r].value);return t}var empty_pair="nn";