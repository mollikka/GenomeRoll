function setup_breed_button(e,t,n,r,a,i,u,o,l,p,c,d){var s=document.createElement("input");s.type="button",s.value="Make babies!",s.onclick=function(){breed_pups(e,t,n,r,a,i,u,o,l,p,d)},c.appendChild(s)}function breed_pups(e,t,n,r,a,i,u,o,l,p,c){var d=get_genomes_from_input(e,t),s=get_traits_from_input(r),v=i.value,m=parse_stats(e,o.value),_=get_genomes_from_input(e,n),f=get_traits_from_input(a),h=u.value,g=parse_stats(e,l.value),b=get_active_specials(e,r,a,p),E=specials_to_effects(e,b),C=breed_pupcount(E),M=document.createElement("div"),T=document.createElement("h3");T.innerHTML="Litter",M.appendChild(T);var L=document.createElement("input");L.type="button",L.value="X",L.onclick=function(){c.removeChild(M)},M.appendChild(L);for(var y=0;C>y;y++){var H=document.createElement("div");H.className="offspring";var T=document.createElement("h3");T.innerHTML="Child",H.appendChild(T);var x=breed_ismale(E),N=document.createElement("p");x?N.innerHTML="Male":N.innerHTML="Female",H.appendChild(N);var O=breed_genomes(e,d,_),k=document.createElement("p");if(k.innerHTML=genomes_to_str(e,O),H.appendChild(k),get_effect_value(E,"extraGenomeRoll",!1)){var S=breed_genomes(e,d,_),B=document.createElement("p");B.innerHTML="extra roll:<br>"+genomes_to_str(e,S),H.appendChild(B)}var A=document.createElement("p");A.innerHTML="Traits: "+breed_traits(e,s,f,x),H.appendChild(A);var R=breed_build(e,v,h,E),j=document.createElement("p");j.innerHTML="Build: "+R,H.appendChild(j);var q=document.createElement("p");q.innerHTML="Stats: "+stats_to_str(calculate_pup_stats(e,m,g,R)),H.appendChild(q),M.appendChild(H)}c.insertBefore(M,c.childNodes[0])}function setup_stats_button(e,t,n,r,a,i,u,o,l,p,c,d){var s=document.createElement("input");s.type="button",s.value="Statistical average",s.onclick=function(){breed_statistics_test(e,t,n,r,a,i,u,o,l,p,d)},c.appendChild(s)}function breed_statistics_test(e,t,n,r,a,i,u,o,l,p,c){var d=(get_genomes_from_input(e,t),get_traits_from_input(r)),s=i.value,v=(parse_stats(e,o.value),get_genomes_from_input(e,n),get_traits_from_input(a)),m=u.value,_=(parse_stats(e,l.value),get_active_specials(e,r,a,p)),f=specials_to_effects(e,_),h=document.createElement("div"),g=document.createElement("h3");g.innerHTML="Statistics test",h.appendChild(g);var b=document.createElement("input");b.type="button",b.value="X",b.onclick=function(){c.removeChild(h)},h.appendChild(b);var E=document.createElement("input");E.type="button",E.value="Repeat",E.onclick=function(){A()},h.appendChild(E);var C=document.createElement("p");h.appendChild(C);var M=document.createElement("p");h.appendChild(M);var T=document.createElement("p");h.appendChild(T);var L=document.createElement("p");h.appendChild(L);var y=document.createElement("p");h.appendChild(y);var H=document.createElement("p");h.appendChild(H),c.insertBefore(h,c.childNodes[0]);var x=0,N={},O={},k={},S={},B=0,A=function(){for(var t=0;1e3>t;t++){x+=1;var n=breed_pupcount(f),r=breed_build(e,s,m,f),a=breed_traits(e,d,v,!0),i=breed_traits(e,d,v,!1);n in N?N[n]+=1:N[n]=1,r in O?O[r]+=1:O[r]=1,breed_ismale(f)&&(B+=1);for(var u=0;u<a.length;u++){var o=a[u];o in k?k[o]+=1:k[o]=1}for(var u=0;u<i.length;u++){var o=i[u];o in S?S[o]+=1:S[o]=1}}C.innerHTML=x.toString()+" repeats",M.innerHTML="PUPS:<br>";for(var t in N)M.innerHTML+=t.toString()+": "+N[t]/x+"<br>";T.innerHTML="MALE RATIO:<br>"+B/x,H.innerHTML="BUILDS:<br>";for(var t in O)H.innerHTML+=t.toString()+": "+O[t]/x+"<br>";L.innerHTML="MALE TRAITS:<br>";for(var t in k)L.innerHTML+=t+": "+k[t]/x+"<br>";y.innerHTML="FEMALE TRAITS:<br>";for(var t in S)y.innerHTML+=t+": "+S[t]/x+"<br>"};A()}function parse_stats(e,t){var n=e.build.stats,r=/([0-9]+[.]?[0-9]*)/g,a=t.match(r);if(null===a)return null;var i=a.map(parseFloat);if(i.length!=n.length)return null;for(var u={},o=0;o<n.length;o++)u[n[o]]=i[o];return u}function setup_build_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Build";var a=document.createElement("select");n.appendChild(r),n.appendChild(a);for(var i in e.build.modifiers){var u=document.createElement("option"),o=document.createTextNode(i);u.value=i,u.appendChild(o),a.appendChild(u)}return t.appendChild(n),a}function setup_stats_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Stats",n.appendChild(r);var a=document.createElement("input");return n.appendChild(a),t.appendChild(n),a.oninput=function(){null===parse_stats(e,this.value)?this.className="invalid_input":this.className="valid_input"},a.oninput(),a}function stats_to_str(e){strs=[];for(var t in e)strs.push(t+": "+e[t].toFixed());return strs.join(", ")}function calculate_pup_stats(e,t,n,r){for(var a={},i=0;i<e.build.stats.length;i++){var u=e.build.stats[i];a[u]=(t[u]+n[u])/e.build.modifiers[r]}return a}function get_pup_build_choices(e,t,n){return t+n in e.build.inheritance?e.build.inheritance[t+n]:n+t in e.build.inheritance?e.build.inheritance[n+t]:null}function breed_build(e,t,n,r){var a=get_effect_value(r,"bestAvailableBuild",!1),i=get_pup_build_choices(e,t,n);return a?i.slice(0).sort(function(t,n){return e.build.modifiers[t]-e.build.modifiers[n]})[0]:i[Math.floor(Math.random()*i.length)]}function setup_genome_input(e,t){var n=document.createElement("div");n.className="input_container";var r=document.createElement("h3");r.innerHTML="Genome",n.appendChild(r);for(var a in e.genotypes){var i=document.createElement("input");i.type="text",i.re_genes=get_genome_template(e,a);var r=document.createElement("h4");r.innerHTML=a;var u=document.createElement("div");i.output=u,n.appendChild(r),n.appendChild(i),n.appendChild(u),i.oninput=function(){null===str_to_genome(this.value,this.re_genes)?this.className="invalid_input":this.className="valid_input"},i.oninput()}return t.appendChild(n),n}function get_genome_template(e,t){var n=e.genotypes[t],r=[];for(var a in n){var i=a,u=n[a].genotypes,o=n[a].required,l=u.join("|"),p=new RegExp("^("+l+")("+l+")$"),c=[i,p,o];r.push(c)}return r}function str_to_gene(e,t,n){var r=t,a=e[r][0],i=e[r][1],u=n.match(i);return null===u?null:(gene_left=u[1],gene_right=u[2],[a,gene_left,gene_right])}function verify_required(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=r[2],i=r[0];if(a&&!(i in t))return!1}return!0}function str_to_genome(e,t){for(var n={},r=/[ ]+/,a=0,i=e.split(r),u=0;u<i.length;u++){var o=i[u];if(""!==o&&o!==empty_pair){for(var l=null,p=a;p<t.length;p++){var c=str_to_gene(t,p,o);if(null!==c){l=c,a=p+1;break}}if(null===l)return null;n[l[0]]=[l[1],l[2]]}}return verify_required(t,n)?n:null}function get_genomes_from_input(e,t){for(var n={},r=t.getElementsByTagName("input"),a=0;a<r.length;a++){var i=Object.keys(e.genotypes)[a],u=r[a].re_genes;n[i]=str_to_genome(r[a].value,u)}return n}function genomes_to_str(e,t){str="";for(var n in t)str+=n+": "+genome_to_str(e,n,t[n])+"<br>";return str}function genome_to_str(e,t,n){function r(n){var r=function(r,a){return e.genotypes[t][n].genotypes.indexOf(r)-e.genotypes[t][n].genotypes.indexOf(a)};return r}var a=[];for(var i in n)if("n"!=n[i][0]||"n"!=n[i][1]){var u=n[i].slice(0).sort(r(i));a.push(u.join(""))}return a.join(" ")}function breed_genomes(e,t,n){var r=e.genotypes,a={};for(var i in r){var u={};for(var o in r[i]){var l,p;l=t[i][o],p=n[i][o],void 0===l&&(l=["n","n"]),void 0===p&&(p=["n","n"]);var c=l[Math.floor(2*Math.random())],d=p[Math.floor(2*Math.random())];u[o]=[c,d]}a[i]=u}return a}function setup_special_options(e,t,n,r){var a=e.special,i=document.createElement("div");i.className="input_container";var u=document.createElement("ul");i.appendChild(u);var o={};for(var l in a)if("option"==a[l].activation[0]){var p=document.createElement("li");o[l]=p,u.appendChild(p);var c=document.createElement("input");c.type="checkbox",c.value=l,p.appendChild(c);var d=document.createTextNode(l);p.appendChild(d)}var s=function(){for(var i in o)o[i].className="";for(var i in o)for(var u=i,l=o[i],p=get_user_specials(e,t,n,r),c=a[u].disabledwith,d=0;d<c.length;d++)if(p.indexOf(c[d])>-1){l.className="invalid_option";break}};for(var l in o)o[l].onclick=s;return r.appendChild(i),i}function get_user_specials(e,t,n,r){for(var a=get_traits_from_input(n),i=get_traits_from_input(t),u=[],o=r.getElementsByTagName("input"),l=0;l<o.length;l++){var p=o[l];p.checked&&u.push(p.value)}var c=e.special,d=[];for(var s in c){var v=c[s],m=v.activation[0];if("option"==m)u.indexOf(s)>-1&&d.push(s);else if("trait"==m){var _=v.activation[1];a.indexOf(_)>-1?d.push(s):i.indexOf(_)>-1&&d.push(s)}}return d}function get_active_specials(e,t,n,r){for(var a=get_user_specials(e,t,n,r),i=e.special,u=a.slice(),o=0;o<a.length;o++){var l=a[o];if(-1!=u.indexOf(l))for(var p=i[l].disabledwith,c=0;c<p.length;c++)if(a.indexOf(p[c])>-1){u.splice(u.indexOf(l),1);break}}return u}function specials_to_effects(e,t){var n={},r=function(e,t){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])<0)return!1;return!0},a=e.effects;for(var i in a){var u=a[i].type,o=a[i].requires,l=a[i].value;r(t,o)&&(n[u]=l)}return n}function get_effect_value(e,t,n){var r=n;return t in e&&(r=e[t]),r}function breed_ismale(e){var t=get_effect_value(e,"maleChance",.5);return Math.random()<t?!0:!1}function breed_pupcount(e){var t,n=get_effect_value(e,"offspringChance",[0,1]),r=Math.random(),a=0;for(t=0;t<n.length&&(a+=n[t],!(a>r));t++);return t}function setup_trait_input(e,t,n){var r=document.createElement("div");r.className="input_container";var a=document.createElement("h3");a.innerHTML="Traits",r.appendChild(a);var i=document.createElement("ul");r.appendChild(i);var u=e.traits;for(var o in u){var l=u[o];if((!n||l.male)&&(n||l.female)&&0!==l.inherit){var p=document.createElement("li"),c=document.createElement("input"),a=document.createTextNode(o);c.type="checkbox",c.value=o,p.appendChild(c),p.appendChild(a),i.appendChild(p)}}return t.appendChild(r),i}function calculate_pup_traits(e,t,n,r){var a=e.traits,i={};for(var u in a){var o=a[u];!r&&!o.female||r&&!o.male?i[u]=0:t.indexOf(u)>-1&&n.indexOf(u)>-1?i[u]=1-(1-o.mutate)*(1-o.inherit)*(1-o.inherit):t.indexOf(u)>-1||n.indexOf(u)>-1?i[u]=1-(1-o.mutate)*(1-o.inherit):i[u]=o.mutate}return i}function breed_traits(e,t,n,r){var a=calculate_pup_traits(e,t,n,r),i=[];for(var u in a){var o=a[u];Math.random()<o&&i.push(u)}return i}function get_traits_from_input(e){for(var t=[],n=e.getElementsByTagName("input"),r=0;r<n.length;r++)n[r].checked&&t.push(n[r].value);return t}var empty_pair="nn";