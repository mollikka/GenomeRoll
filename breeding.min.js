function setup_breed_button(e,n,t,r,a,i,l,o,u){var d=document.createElement("input");d.type="button",d.value="Make a baby!",d.onclick=function(){breed_one_pup(e,n,t,r,a,i,l,u),console.log("ASD")},o.appendChild(d)}function breed_one_pup(e,n,t,r,a,i,l,o){var u=get_genomes_from_input(e,n),d=get_traits_from_input(r),c=i.value,p=get_genomes_from_input(e,t),s=get_traits_from_input(a),m=l.value,v=document.createElement("div");v.className="offspring";var h=document.createElement("h3");h.innerHTML="Child",v.appendChild(h);var _=breed_ismale(),f=document.createElement("p");_?f.innerHTML="Male":f.innerHTML="Female",v.appendChild(f),console.log(u),console.log(p);var g=breed_genomes(e,u,p),E=document.createElement("p");console.log(g),console.log(genomes_to_str(e,g)),E.innerHTML=genomes_to_str(e,g),v.appendChild(E);var b=document.createElement("p");b.innerHTML="Traits: "+breed_traits(e,d,s,_),v.appendChild(b);var C=document.createElement("p");C.innerHTML="Build: "+breed_build(e,c,m),v.appendChild(C);var N=document.createElement("input");N.type="button",N.value="X",N.onclick=function(){o.removeChild(v)},v.appendChild(N),o.appendChild(v)}function parse_stats(e,n){var t=e.build.stats,r=/([0-9]+[.]?[0-9]*)/g,a=n.match(r);if(null===a)return null;var i=a.map(parseFloat);if(i.length!=t.length)return null;for(var l={},o=0;o<t.length;o++)l[t[o]]=i[o];return l}function setup_build_input(e,n){var t=document.createElement("div");t.className="input_container";var r=document.createElement("h3");r.innerHTML="Build";var a=document.createElement("select");t.appendChild(r),t.appendChild(a);for(var i in e.build.modifiers){var l=document.createElement("option"),o=document.createTextNode(i);l.value=i,l.appendChild(o),a.appendChild(l)}return n.appendChild(t),a}function setup_stats_input(e,n){var t=document.createElement("div");t.className="input_container";var r=document.createElement("h3");r.innerHTML="Stats",t.appendChild(r);var a=document.createElement("input");return t.appendChild(a),n.appendChild(t),a.oninput=function(){""===this.value?this.className="":null===parse_stats(e,this.value)?this.className="invalid_input":this.className="valid_input"},n}function calculate_pup_stats(e,n,t,r){for(var a={},i=0;i<e.build.stats.length;i++){var l=e.build.stats[i];a[l]=(n[l]+t[l])/e.build.modifiers[r]}return a}function get_pup_build_choices(e,n,t){return n+t in e.build.inheritance?e.build.inheritance[n+t]:t+n in e.build.inheritance?e.build.inheritance[t+n]:null}function breed_build(e,n,t){var r=get_pup_build_choices(e,n,t);return r[Math.floor(Math.random()*r.length)]}function setup_genome_input(e,n){var t=document.createElement("div");t.className="input_container";var r=document.createElement("h3");r.innerHTML="Genome",t.appendChild(r);for(var a in e.genotypes){var i=document.createElement("input");i.type="text",i.re_genes=get_genome_template(e,a);var r=document.createElement("h4");r.innerHTML=a;var l=document.createElement("div");i.output=l,t.appendChild(r),t.appendChild(i),t.appendChild(l),i.oninput=function(){""==this.value?this.className="":null===str_to_genome(this.value,this.re_genes)?this.className="invalid_input":this.className="valid_input"}}return n.appendChild(t),t}function get_genome_template(e,n){var t=e.genotypes[n],r=[];for(var a in t){var i=a,l=t[a].genotypes,o=t[a].required,u=l.join("|"),d=new RegExp("^("+u+")("+u+")$"),c=[i,d,o];r.push(c)}return r}function str_to_gene(e,n,t){var r=n,a=e[r][0],i=e[r][1],l=t.match(i);return console.log("Testing if",t,"is",a," - ",!(null===l)),null===l?null:(gene_left=l[1],gene_right=l[2],[a,gene_left,gene_right])}function verify_required(e,n){for(var t=0;t<e.length;t++){var r=e[t],a=r[2],i=r[0];if(a&&!(i in n))return!1}return!0}function str_to_genome(e,n){console.log("PARSING GENOME",e);for(var t={},r=/[ ]+/,a=0,i=e.split(r),l=0;l<i.length;l++){var o=i[l];if(""!==o&&o!==empty_pair){for(var u=null,d=a;d<n.length;d++){var c=str_to_gene(n,d,o);if(null!==c){u=c,a=d+1;break}}if(null===u)return console.log("FAILED TO PARSE GENOME"),null;t[u[0]]=[u[1],u[2]]}}return verify_required(n,t)?(console.log("GENOME PARSED SUCCESSFULLY"),t):(console.log("REQUIRED GENE MISSING"),null)}function get_genomes_from_input(e,n){for(var t={},r=n.getElementsByTagName("input"),a=0;a<r.length;a++){var i=Object.keys(e.genotypes)[a],l=r[a].re_genes;t[i]=str_to_genome(r[a].value,l)}return t}function genomes_to_str(e,n){str="";for(var t in n)str+=t+": "+genome_to_str(e,t,n[t])+"<br>";return str}function genome_to_str(e,n,t){function r(t){var r=function(r,a){return e.genotypes[n][t].genotypes.indexOf(r)-e.genotypes[n][t].genotypes.indexOf(a)};return r}var a=[];for(var i in t)if("n"!=t[i][0]||"n"!=t[i][1]){var l=t[i].slice(0).sort(r(i));a.push(l.join(""))}return a.join(" ")}function breed_genomes(e,n,t){var r=e.genotypes,a={};for(var i in r){var l={};for(var o in r[i]){var u,d;u=n[i][o],d=t[i][o],void 0===u&&(u=["n","n"]),void 0===d&&(d=["n","n"]),console.log(u,d);var c=u[Math.floor(2*Math.random())],p=d[Math.floor(2*Math.random())];l[o]=[c,p]}a[i]=l}return a}function setup_special_options(e,n){var t=e.special,r=document.createElement("div");r.className="input_container";var a=document.createElement("ul");r.appendChild(a);for(var i in t)if("option"==t[i].activation[0]){var l=document.createElement("li");a.appendChild(l);var o=document.createElement("input");o.type="checkbox",o.value=i,l.appendChild(o);var u=document.createTextNode(i);l.appendChild(u)}n.appendChild(r)}function get_active_effects(e,n,t,r){for(var a=[],i=[],l=[],o=t.getElementsByTagName("input"),u=0;u<o.length;u++){var d=o[u];d.checked&&a.push(d.value)}for(var c=n.getElementsByTagName("input"),u=0;u<c.length;u++){var d=c[u];d.checked&&i.push(d.value)}for(var p=r.getElementsByTagName("input"),u=0;u<p.length;u++){var d=p[u];d.checked&&l.push(d.value)}var s=e.special,m=[];for(var v in s){var h=s[v],_=h.activation[0];if("option"==_)l.indexOf(v)>-1&&m.push(v);else if("trait"==_){var f=h.activation[1];a.indexOf(f)>-1?m.push(v):i.indexOf(f)>-1&&m.push(v)}}for(var g=m.slice(),u=0;u<m.length;u++){var h=m[u];if(-1!=g.indexOf(h))for(var E=s[h].disabledwith,b=0;b<E.length;b++)if(m.indexOf(E[b])>-1){g.splice(g.indexOf(h),1);break}}return g}function breed_ismale(){return Math.random()<.5?!0:!1}function setup_trait_input(e,n,t){var r=document.createElement("div");r.className="input_container";var a=document.createElement("h3");a.innerHTML="Traits",r.appendChild(a);var i=document.createElement("ul");r.appendChild(i);var l=e.traits;for(var o in l){var u=l[o];if((!t||u.male)&&(t||u.female)&&0!==u.inherit){var d=document.createElement("li"),c=document.createElement("input"),a=document.createTextNode(o);c.type="checkbox",c.value=o,d.appendChild(c),d.appendChild(a),i.appendChild(d)}}return n.appendChild(r),i}function calculate_pup_traits(e,n,t,r){var a=e.traits,i={};for(var l in a){var o=a[l];!r&&!o.female||r&&!o.male?i[l]=0:n.indexOf(l)>-1&&t.indexOf(l)>-1?i[l]=1-(1-o.mutate)*(1-o.inherit)*(1-o.inherit):n.indexOf(l)>-1||t.indexOf(l)>-1?i[l]=1-(1-o.mutate)*(1-o.inherit):i[l]=o.mutate}return i}function breed_traits(e,n,t,r){var a=calculate_pup_traits(e,n,t,r),i=[];for(var l in a){var o=a[l];Math.random()<o&&i.push(l)}return i}function get_traits_from_input(e){for(var n=[],t=e.getElementsByTagName("input"),r=0;r<t.length;r++)t[r].checked&&n.push(t[r].value);return n}var empty_pair="nn";